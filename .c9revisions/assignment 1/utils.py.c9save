{"ts":1351728772130,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"import itertools\nimport numpy as np\nfrom numpy import genfromtxt\nimport matplotlib.mlab as mlab\nimport urllib2\nimport urllib\nimport datetime\nimport os\n\n'''\nDownloads the equities information from Yahoo Finance\n'''\ndef yahoo_pull(symbols, start_date, end_date=None, data_path='./data/'):\n    #Create path if it doesn't exist\n    if not (os.access(data_path, os.F_OK)):\n        os.makedirs(data_path)\n\n    #utils.clean_paths(data_path)\n\n    if end_date == None:\n        end_date = datetime.datetime.now()\n\n    miss_ctr = 0  # Counts how many symbols we could not get\n    for symbol in symbols:\n        symbol_name = symbol\n        if symbol[0] == '$':\n            symbol = '^' + symbol[1:]\n\n        symbol_data = list()\n        print \"Getting: \" + str (symbol_name)\n\n        try:\n            params = urllib.urlencode({\n                                        's': str(symbol),\n                                        'a': start_date.month - 1, 'b': start_date.day, 'c': start_date.year,\n                                        'd': end_date.month - 1, 'e': end_date.day, 'f': end_date.year\n                                    })\n            url_get = urllib2.urlopen(\"http://ichart.finance.yahoo.com/table.csv?%s\" % params)\n\n            header = url_get.readline()\n            symbol_data.append(url_get.readline())\n            while (len(symbol_data[-1]) > 0):\n                symbol_data.append(url_get.readline())\n\n            symbol_data.pop(-1)  # The last element is going to be the string of length zero. We don't want to write that to file.\n            # now writing data to file\n            f = open(data_path + symbol_name + \".csv\", 'w')\n\n            #Writing the header\n            f.write(header)\n\n            while (len(symbol_data) > 0):\n                f.write(symbol_data.pop(0))\n\n            f.close()\n            print \"Done: \" + str (symbol_name)\n\n        except urllib2.HTTPError:\n            miss_ctr = miss_ctr + 1\n            print \"Unable to fetch data for stock: \" + str(symbol_name)\n        except urllib2.URLError:\n            print \"URL Error for stock: \" + str(symbol_name)\n\n    print \"All done. Got \" + str(len(symbols) - miss_ctr) + \" stocks. Could not get \" + str(miss_ctr) + \" stocks.\"\n\n\n'''\nGet the data of a symbol already downloaded\n'''\ndef get_data(symbol):\n    #return genfromtxt('./data/%s.csv' % symbol, delimiter=',', skip_header=1)\n    return mlab.csv2rec('./data/%s.csv' % symbol)[::-1] # Reverse\n\n'''\nGet only the close column of a symbol\n'''\ndef get_close(symbol):\n    return get_data(symbol).adj_close\n\n'''\nCompletes the data for missing records\nSaves the new files\n'''\ndef complete_data(symbols):\n    for symbol in symbols:\n        complete_data_single(symbol, saveNewFile=True)\n\n'''\nCompletes the data for missing records can return the array or \nsave a new file\n'''\ndef complete_data_single(symbol, saveNewFile=False):\n    good_dates = get_data(\"SPY\").date\n    data = get_data(symbol)\n    dates = data.date\n    \n    # First check if the records from the first days are missing\n    # and fill this data with the record found\n    if not(good_dates[0] in dates):\n        # First find the most recent values that is on the data\n        open_val = data[0][1]\n        high = data[0][2]\n        low = data[0][3]\n        close = data[0][4]\n        volume = data[0][5]\n        adj_close = data[0][6]\n        \n        # Then add that record to the beginning until data starts\n        # it is necesary to modify the date\n        i = 0\n        while not(good_dates[i] in dates):\n            new = (good_dates[i], open_val, high, low, close, volume, adj_close)\n            #n = np.array(most_recent, dtype=data.dtype)\n            data = np.insert(data, i, new, 0)  \n            i = i + 1\n\n    # TODO: Missing values not onthe beginning\n\n    if saveNewFile:\n        try:\n            os.remove('./data/%s - old.csv' % symbol)\n        except:\n            pass\n        os.rename('./data/%s.csv' % symbol, './data/%s - old.csv' % symbol)\n        mlab.rec2csv(data, './data/%s.csv' % symbol, delimiter=',')\n\n    return data\n        \n\n'''\nCalculates the daily return for an array\nReturns: An array with every return\n'''\ndef daily_return(close):\n    daily_ret = 0  # First return is 0\n    for i in range(len(close)):\n        if i != 0:\n            ret = (close[i] / close[i - 1]) - 1\n            daily_ret = np.append(daily_ret, ret)\n\n    return daily_ret\n\n'''\nCalculates the anual return for an array\nReturns: int with the return\n'''\ndef anual_return(close):\n    return close[len(close) - 1] / close[0] - 1\n\n'''\nCalculates the cumulative return for an array\nReturns: array with each cumulative return\n'''\ndef cumulative_return(close):\n    init_val = close[0]\n    cum_ret = 1  # First return is 100%\n    for i in range(len(close)):\n        if i != 0:\n            ret = (close[i] / init_val)\n            cum_ret = np.append(cum_ret, ret)\n\n    return cum_ret\n\n'''\nCalculates the average daily return of an array\nReturn: int with the avg\n'''\ndef avg_daily_return(close):\n    return np.average(daily_return(close))\n\n'''\nCalculates the standar deviation of the daily return of an array\nReturn: int with the std\n'''\ndef std_daily_return(close):\n    return np.std(daily_return(close), dtype=np.float64)\n\n'''\nCalculates the sharpe ratio of an array\nReturn: int with the sharpe ratio\n'''\ndef sharpe_ratio(close):\n    day = daily_return(close)\n    avg = np.average(day)\n    std = np.std(day, dtype=np.float64)\n    return np.sqrt(252) * avg / std\n\n'''\nReads a .txt file and returns the symbols from that file\n'''\ndef read_symbols(s_symbols_file):\n    symbols = []\n    file = open(s_symbols_file, 'r')\n    for f in file.readlines():\n        symbols.append(f.strip())\n    file.close()\n\n    return symbols\n\nif __name__ == '__main__':\n    #symbols = read_symbols('symbols.txt')\n    symbols = ['CNC', 'TRGP', 'ROST', 'OKE', 'HUM', 'VFC', 'BIIB', 'MA', 'EP', 'WCG']\n    symbols = ['HDGE', 'AGOL', 'GGGG' ,'SDIV', 'FWDB', 'NKY'] # Best EFT from a site\n    start_date = datetime.date(2011, 1, 1)\n    end_date = datetime.date(2011, 12, 31)\n    #yahoo_pull(symbols, start_date, end_date)\n    complete_data(symbols)\n    \n    "]],"start1":0,"start2":0,"length1":0,"length2":6130}]],"length":6130}
{"contributors":[],"silentsave":false,"ts":1351728870291,"patch":[[{"diffs":[[0,"s.txt')\n"],[1,"    symbols = ['HDGE', 'AGOL', 'GGGG' ,'SDIV', 'FWDB', 'NKY'] # Best EFT from a site\n"],[0,"    symb"]],"start1":5782,"start2":5782,"length1":16,"length2":101},{"diffs":[[0,"= ['"],[-1,"HDGE', 'AGOL', 'GGGG' ,'SDIV', 'FWD"],[1,"ROST', 'OKE', 'BII"],[0,"B', '"],[-1,"NKY"],[1,"GLD"],[0,"'] #"]],"start1":5973,"start2":5973,"length1":51,"length2":34},{"diffs":[[0,"LD'] # Best "],[-1,"EFT "],[0,"from "],[-1,"a sit"],[1,"previous lin"],[0,"e\n    start_"]],"start1":6001,"start2":6001,"length1":38,"length2":41}]],"length":6201,"saved":false}
{"ts":1351728875699,"patch":[[{"diffs":[[0,"31)\n    "],[-1,"#"],[0,"yahoo_pu"]],"start1":6114,"start2":6114,"length1":17,"length2":16},{"diffs":[[0,"d_date)\n    "],[1,"#"],[0,"complete_dat"]],"start1":6156,"start2":6156,"length1":24,"length2":25}]],"length":6201,"saved":false}
{"ts":1351731382422,"patch":[[{"diffs":[[0,"us line\n"],[1,"    symbols = ['BIIB', 'PFE', 'BMY', 'D', 'PM', 'GLD'] # Best for bloomberg\n"],[0,"    star"]],"start1":6024,"start2":6024,"length1":16,"length2":92}]],"length":6277,"saved":false}
{"ts":1351731619928,"patch":[[{"diffs":[[0,"oomberg\n"],[1,"    symbols = ['BBH', 'IHE', 'PJP', 'XLU', 'VPU', 'IDU', 'FXG', 'PPH', 'XLP', 'VDC'] # Best ETF stocks for bloomberg\n"],[0,"    star"]],"start1":6100,"start2":6100,"length1":16,"length2":133}]],"length":6394,"saved":false}
{"ts":1351731820963,"patch":[[{"diffs":[[0,"31)\n    "],[1,"#"],[0,"yahoo_pu"]],"start1":6307,"start2":6307,"length1":16,"length2":17},{"diffs":[[0,"te)\n    "],[-1,"#"],[0,"complete"]],"start1":6354,"start2":6354,"length1":17,"length2":16}]],"length":6394,"saved":false}
